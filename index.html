<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <title>Sirius Javascript Simulator</title>
    <style>
      th {
        text-align: left;
      }
    </style>
    <script type="text/javascript" src="./js/config.js"></script>
    <script type="text/javascript" src="./js/initial-balancing.js"></script>
    <script type="text/javascript" src="./js/event-listeners.js"></script>
    <script type="text/javascript" src="./js/simulator-functions.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      let tempIdKey;
      let tempToken;
      let newUserCreated;
      let token;
      let initialBalancingCreated;
      let latestBalancingRetrieved;
      let latestInventoryRetrieved;
      let settlementCreated;
      let buildingsCreated = new Array();
      let productionCollected = new Array();

      let buildingBarracksTimerInterval;
      let buildingFarmTimerInterval;
      let buildingGoldMineTimerInterval;
      let buildingLumberMillTimerInterval;
      let buildingIronMineTimerInterval;

      let barracksBuildTime;
      let farmBuildTime;
      let goldMineBuiltTime;
      let lumberMillBuildTime;
      let ironMineBuildTime;

      let barracksBuildingIdForCollection;
      let farmBuildingIdForCollection1;
      let farmBuildingIdForCollection2;
      let farmBuildingIdForCollection3;
      let goldMineBuildingIdForCollection;
      let lumberMillBuildingIdForCollection;
      let ironMineBuildingIdForCollection;

      let isBarracksReadyForCollection = false;
      let isFarmReadyForCollection1 = false;
      let isFarmReadyForCollection2 = false;
      let isFarmReadyForCollection3 = false;
      let isGoldMineReadyForCollection1 = false;
      let isGoldMineReadyForCollection2 = false;
      let isGoldMineReadyForCollection3 = false;
      let isLumberMillReadyForCollection1 = false;
      let isLumberMillReadyForCollection2 = false;
      let isLumberMillReadyForCollection3 = false;
      let isIronMineReadyForCollection1 = false;
      let isIronMineReadyForCollection2 = false;
      let isIronMineReadyForCollection3 = false;

      document.addEventListener("DOMContentLoaded", (event) => {
        console.log("DOMContentLoaded event triggered");

        init();
      });

      const init = () => {
        console.log("init() called");
        intialState();
      };

      const intialState = () => {
        console.log("intialState() called");
        disableLoginButtons();
        hideBuildBuildingsControls();
        hideProductionControls();
        hideInventoryControls();
      };

      const postLoginState = () => {
        console.log("postLoginState() called");
        retrieveLatestBalancing();
        retrieveUserInventory();
        hideRegistrationControl();
        hideLoginControls();
        buildSettlement();
      };

      const hideRegistrationControl = () => {
        console.log("hideRegistrationControl() called");
        document.getElementById("register-button").style.visibility = "hidden";
      };
      const hideLoginControls = () => {
        console.log("hideLoginControlrs() called");
        document.getElementById("login-button").style.visibility = "hidden";
      };

      const disableRegistrationButton = () => {
        console.log("disableRegistrationButton() called");
        document.getElementById("register-button").disabled = true;
      };

      const disableLoginButtons = () => {
        console.log("disableLoginButtons() called");
        document.getElementById("login-button").disabled = true;
      };

      const enableLoginButtons = () => {
        console.log("enableLoginButtons() called");
        document.getElementById("login-button").disabled = false;
      };

      const hideProductionControls = () => {
        console.log("hideProductionControls() called");
        document.getElementById("production-buttons-row").style.visibility =
          "hidden";
      };

      const showProductionControls = () => {
        console.log("showProductionControls() called");
        document.getElementById("production-buttons-row").style.visibility =
          "visible";
      };

      const disableProductionButtons = () => {
        console.log("disableProductionButtons() called");
        document.getElementById("produce-barracks-button").disabled = true;
        document.getElementById("produce-farm-button").disabled = true;
        document.getElementById("produce-gold-mine-button").disabled = true;
        document.getElementById("produce-lumber-mill-button").disabled = true;
        document.getElementById("produce-iron-mine-button").disabled = true;
      };

      const hideInventoryControls = () => {
        console.log("hideInventoryControls() called");
        document.getElementById("inventory-info").style.visibility = "hidden";
        document.getElementById("inventory-soldiers").style.visibility =
          "hidden";
        document.getElementById("inventory-food").style.visibility = "hidden";
        document.getElementById("inventory-gold").style.visibility = "hidden";
        document.getElementById("inventory-lumber").style.visibility = "hidden";
        document.getElementById("inventory-iron").style.visibility = "hidden";
      };

      const showInventoryControls = () => {
        console.log("showInventoryControls() called");
        document.getElementById("inventory-info").style.visibility = "visible";
        document.getElementById("inventory-soldiers").style.visibility =
          "visible";
        document.getElementById("inventory-food").style.visibility = "visible";
        document.getElementById("inventory-gold").style.visibility = "visible";
        document.getElementById("inventory-lumber").style.visibility =
          "visible";
        document.getElementById("inventory-iron").style.visibility = "visible";
      };

      //hides the build buildings controls - buttons, timers, status
      const hideBuildBuildingsControls = () => {
        console.log("hideBuildBuildingsControls() called");
        document.getElementById("build-barracks-row-1").style.visibility =
          "hidden";
        document.getElementById("build-farm-row-1").style.visibility = "hidden";
        document.getElementById("build-farm-row-2").style.visibility = "hidden";
        document.getElementById("build-farm-row-3").style.visibility = "hidden";
        document.getElementById("build-gold-mine-row-1").style.visibility =
          "hidden";
        document.getElementById("build-gold-mine-row-2").style.visibility =
          "hidden";
        document.getElementById("build-gold-mine-row-3").style.visibility =
          "hidden";
        document.getElementById("build-lumber-mill-row-1").style.visibility =
          "hidden";
        document.getElementById("build-lumber-mill-row-2").style.visibility =
          "hidden";
        document.getElementById("build-lumber-mill-row-3").style.visibility =
          "hidden";
        document.getElementById("build-iron-mine-row-1").style.visibility =
          "hidden";
        document.getElementById("build-iron-mine-row-2").style.visibility =
          "hidden";
        document.getElementById("build-iron-mine-row-3").style.visibility =
          "hidden";
      };

      const showBuildBuildingsControls = () => {
        console.log("showBuildBuildingsControls() called");
        document.getElementById("build-barracks-row-1").style.visibility =
          "visible";
        document.getElementById("build-farm-row-1").style.visibility =
          "visible";
        document.getElementById("build-farm-row-2").style.visibility =
          "visible";
        document.getElementById("build-farm-row-3").style.visibility =
          "visible";
        document.getElementById("build-gold-mine-row-1").style.visibility =
          "visible";
        document.getElementById("build-gold-mine-row-2").style.visibility =
          "visible";
        document.getElementById("build-gold-mine-row-3").style.visibility =
          "visible";
        document.getElementById("build-lumber-mill-row-1").style.visibility =
          "visible";
        document.getElementById("build-lumber-mill-row-2").style.visibility =
          "visible";
        document.getElementById("build-lumber-mill-row-3").style.visibility =
          "visible";
        document.getElementById("build-iron-mine-row-1").style.visibility =
          "visible";
        document.getElementById("build-iron-mine-row-2").style.visibility =
          "visible";
        document.getElementById("build-iron-mine-row-3").style.visibility =
          "visible";
      };

      const registerHandler = async () => {
        console.log("registerHandler() called");

        tempIdKey = readTempIdKeyFromConfig();
        tempToken = await login(tempIdKey);
        bearerToken = tempToken.accessToken;

        newUserCreated = await register();

        let elem = document.querySelector("#user-info");

        elem.innerHTML =
          "New user with username " + newUserCreated.username + " registered";

        disableRegistrationButton();
        enableLoginButtons();
      };

      const loginHandler = async () => {
        console.log("loginHandler() called");

        const userForLogin = {
          siriusId: newUserCreated.siriusId,
          siriusKey: newUserCreated.siriusKey,
          appId: tempIdKey.appId,
          appKey: tempIdKey.appKey,
        };

        token = await login(userForLogin);
        bearerToken = token.accessToken;

        let elem = document.querySelector("#user-info");

        // Get HTML content
        let html = elem.innerHTML;

        if (
          token.accessToken !== null &&
          token.accessToken !== "undefined" &&
          token.accesToken !== ""
        ) {
          elem.innerHTML =
            "Welcome user " +
            newUserCreated.username +
            " , you are now logged in";

          postLoginState();
        }
      };

      const retrieveLatestBalancing = async () => {
        console.log("retrieveLatestBalancing() called");

        latestBalancingRetrieved = await latestBalancing((balancing) => {
          console.log("Latest balancing data found");
          console.log(balancing.contents);

          for (i = 0; i < balancing.contents.Building.length; i++) {
            if (balancing.contents.Building[i].id === "barracks") {
              barracksBuildTime = balancing.contents.Building[i].buildTime;
            }

            if (balancing.contents.Building[i].id === "farm") {
              farmBuildTime = balancing.contents.Building[i].buildTime;
            }

            if (balancing.contents.Building[i].id === "gold-mine") {
              goldMineBuiltTime = balancing.contents.Building[i].buildTime;
            }

            if (balancing.contents.Building[i].id === "lumber-mill") {
              lumberMillBuildTime = balancing.contents.Building[i].buildTime;
            }

            if (balancing.contents.Building[i].id === "iron-mine") {
              ironMineBuildTime = balancing.contents.Building[i].buildTime;
            }
          }

          //initialize the building controls
          for (i = 0; i < balancing.contents.Building.length; i++) {
            for (j = 0; j < balancing.contents.Building[i].maxQuantity; j++) {
              const timerSelector =
                "#build-" +
                balancing.contents.Building[i].id +
                "-timer-" +
                (j + 1);
              const statusSelector =
                "#build-" +
                balancing.contents.Building[i].id +
                "-status-" +
                (j + 1);

              let elem = document.querySelector(timerSelector);
              elem.value =
                "hours:0, minute:0, seconds:" +
                balancing.contents.Building[i].buildTime;

              elem = document.querySelector(statusSelector);
              elem.value = "Ready to build";
            }
          }
        });
      };

      const retrieveUserInventory = async () => {
        console.log("retrieveUserInventory() called");

        latestInventoryRetrieved = await latestUserInventory(
          newUserCreated.id,
          (inventory) => {
            for (i = 0; i < inventory.content.length; i++) {
              const inventoryTableRowSelector =
                "#inventory-" + inventory.content[i].balancingContentId;

              let elem = document.querySelector(inventoryTableRowSelector);
              elem.innerHTML =
                inventory.content[i].balancingContentId +
                ": " +
                inventory.content[i].quantity;
            }
          }
        );
      };

      const monitorBuildingBarracksStatus = async (
        buildingId,
        balancingContentId,
        buildTime,
        buttonNumber
      ) => {
        console.log("monitorBuildingBarracksStatus(...) called");
        console.log("buildingId: " + buildingId);
        console.log("balancingContentId: " + balancingContentId);
        console.log("buildTime: " + buildTime);

        let activatedBuilding;

        while (true) {
          console.log("monitoring if barracks is activated");
          await sleep(buildTime + "000");
          activatedBuilding = await getBuilding(buildingId);

          if (activatedBuilding.status === "activated") {
            buildingsCreated.push(activatedBuilding);
            sleep(1000);
            buildBarracksActivatedCallback(activatedBuilding, buttonNumber);
            eval(
              "barracksBuildingIdForCollection" +
                buttonNumber +
                "= activatedBuilding.id"
            );
            console.log("activated building id: " + activatedBuilding.id);
            console.log(
              "activated building balancing content id: " +
                activatedBuilding.balancingContentId
            );
            console.log(
              "activated building status: " + activatedBuilding.status
            );
            console.log(
              "List of buildings created: " + JSON.stringify(buildingsCreated)
            );

            break;
          }
        }
      };

      const monitorBuildingFarmStatus = async (
        buildingId,
        balancingContentId,
        buildTime,
        buttonNumber
      ) => {
        console.log("monitorBuildingFarmStatus(...) called");
        console.log("buildingId: " + buildingId);
        console.log("balancingContentId: " + balancingContentId);
        console.log("buildTime: " + buildTime);

        let activatedBuilding;

        while (true) {
          console.log("monitoring if farm is activated");
          await sleep(buildTime + "000");
          activatedBuilding = await getBuilding(buildingId);

          if (activatedBuilding.status === "activated") {
            buildingsCreated.push(activatedBuilding);
            sleep(1000);
            buildFarmActivatedCallback(activatedBuilding, buttonNumber);
            eval(
              "farmBuildingIdForCollection" +
                buttonNumber +
                "= activatedBuilding.id"
            );
            console.log("farmBuildingIdForCollection1: ");
            console.log(farmBuildingIdForCollection1);
            console.log("activated building id: " + activatedBuilding.id);
            console.log(
              "activated building balancing content id: " +
                activatedBuilding.balancingContentId
            );
            console.log(
              "activated building status: " + activatedBuilding.status
            );
            console.log(
              "List of buildings created: " + JSON.stringify(buildingsCreated)
            );

            break;
          }
        }
      };

      const monitorBuildingGoldMineStatus = async (
        buildingId,
        balancingContentId,
        buildTime,
        buttonNumber
      ) => {
        console.log("monitorBuildingGoldMineStatus(...) called");
        console.log("buildingId: " + buildingId);
        console.log("balancingContentId: " + balancingContentId);
        console.log("buildTime: " + buildTime);

        let activatedBuilding;

        while (true) {
          console.log("monitoring if gold-mine is activated");
          await sleep(buildTime + "000");
          activatedBuilding = await getBuilding(buildingId);

          if (activatedBuilding.status === "activated") {
            buildingsCreated.push(activatedBuilding);
            sleep(1000);
            buildGoldMineActivatedCallback(activatedBuilding, buttonNumber);
            eval(
              "goldMineBuildingIdForCollection" +
                buttonNumber +
                "= activatedBuilding.id"
            );
            console.log("activated building id: " + activatedBuilding.id);
            console.log(
              "activated building balancing content id: " +
                activatedBuilding.balancingContentId
            );
            console.log(
              "activated building status: " + activatedBuilding.status
            );
            console.log(
              "List of buildings created: " + JSON.stringify(buildingsCreated)
            );

            break;
          }
        }
      };

      const monitorBuildingLumberMillStatus = async (
        buildingId,
        balancingContentId,
        buildTime,
        buttonNumber
      ) => {
        console.log("monitorBuildingLumberMillStatus(...) called");
        console.log("buildingId: " + buildingId);
        console.log("balancingContentId: " + balancingContentId);
        console.log("buildTime: " + buildTime);

        let activatedBuilding;

        while (true) {
          console.log("monitoring if lumber-mill is activated");
          await sleep(buildTime + "000");
          activatedBuilding = await getBuilding(buildingId);

          if (activatedBuilding.status === "activated") {
            buildingsCreated.push(activatedBuilding);
            sleep(1000);
            buildLumberMillActivatedCallback(activatedBuilding, buttonNumber);
            eval(
              "lumberMillBuildingIdForCollection" +
                buttonNumber +
                "= activatedBuilding.id"
            );
            console.log("activated building id: " + activatedBuilding.id);
            console.log(
              "activated building balancing content id: " +
                activatedBuilding.balancingContentId
            );
            console.log(
              "activated building status: " + activatedBuilding.status
            );
            console.log(
              "List of buildings created: " + JSON.stringify(buildingsCreated)
            );

            break;
          }
        }
      };

      const monitorBuildingIronMineStatus = async (
        buildingId,
        balancingContentId,
        buildTime,
        buttonNumber
      ) => {
        console.log("monitorBuildingIronMineStatus(...) called");
        console.log("buildingId: " + buildingId);
        console.log("balancingContentId: " + balancingContentId);
        console.log("buildTime: " + buildTime);

        let activatedBuilding;

        while (true) {
          console.log("monitoring if iron-mine is activated");
          await sleep(buildTime + "000");
          activatedBuilding = await getBuilding(buildingId);

          if (activatedBuilding.status === "activated") {
            buildingsCreated.push(activatedBuilding);
            sleep(1000);
            buildIronMineActivatedCallback(activatedBuilding, buttonNumber);
            eval(
              "ironMineBuildingIdForCollection" +
                buttonNumber +
                "= activatedBuilding.id"
            );
            console.log("activated building id: " + activatedBuilding.id);
            console.log(
              "activated building balancing content id: " +
                activatedBuilding.balancingContentId
            );
            console.log(
              "activated building status: " + activatedBuilding.status
            );
            console.log(
              "List of buildings created: " + JSON.stringify(buildingsCreated)
            );

            break;
          }
        }
      };

      const startProduction = async (
        balancingContentId,
        itemId,
        buttonNumber
      ) => {
        console.log("startProduction(..) called");
        console.log("production for " + balancingContentId + " triggered");

        //retrieve the necessary function parameters for starting the production
        let buildingId;

        console.log("buildingsCreated length " + buildingsCreated.length);
        console.log("buildingsCreated...");
        console.log(buildingsCreated);

        for (i = 0; i < buildingsCreated.length; i++) {
          if (buildingsCreated[i].balancingContentId === balancingContentId) {
            buildingId = buildingsCreated[i].id;
            console.log("retrieving building id: " + buildingsCreated[i].id);
            break;
          }
        }

        let production = await createProduction(buildingId, itemId, "start");
        monitorProductionQuantity(
          production.id,
          1,
          itemId,
          balancingContentId,
          buttonNumber
        );
        console.log("production is in progress");
        console.log(production);
      };

      const monitorProductionQuantity = async (
        productionId,
        secondInterval,
        produceId,
        balancingContentId,
        buttonNumber
      ) => {
        console.log("monitorProductionQuantity(....) called");

        while (true) {
          await sleep(secondInterval + "000");

          let monitoredProduction = await retrieveProduction(productionId);

          console.log("checking if we can collect already...");

          console.log("monitoredProduction");
          console.log(monitoredProduction);

          if (
            monitoredProduction.meta !== "undefined" &&
            monitoredProduction.meta.quantity !== 0
          ) {
            console.log(
              "quantity in production is not zero... ready to collect"
            );
            //set the timer
            //set the status
            let elem = document.querySelector(
              "#build-" + balancingContentId + "-status-" + buttonNumber
            );
            elem.value = produceId + " ready for collection";
            //change button name to collect XXXX
            elem = document.querySelector(
              "#build-" + balancingContentId + "-button-" + buttonNumber
            );
            elem.innerHTML = "Collect " + produceId;
            //enable building button to collect
            document.getElementById(
              "build-" + balancingContentId + "-button-" + buttonNumber
            ).disabled = false;
            //change button function call to call collect
            eval(
              "is" +
                balancingContentId.charAt(0).toUpperCase() +
                balancingContentId.substr(1, balancingContentId.length) +
                "ReadyForCollection" +
                buttonNumber +
                " = true"
            );
            //exit the loop
            break;
          }
        }
      };

      const collect = async (buildingBuildingId, produceId) => {
        console.log("collect(..) called");

        let collectedProduction = await collectProduction(buildingBuildingId);

        latestInventoryRetrieved = await latestUserInventory(
          newUserCreated.id,
          (inventory) => {
            let elem = document.querySelector("#inventory-" + produceId);
            if (inventory.content.length !== 0) {
              elem.innerHTML = produceId + ": " + inventory.content[0].quantity;
            }
          }
        );
      };

      const buildingBarracksStartTimer = (
        millisecondTick,
        buildTime,
        buttonNumber
      ) => {
        console.log("buildingBarracksStartTimer(..) called");
        let seconds = buildTime;
        let minutes = 0;
        let hours = 0;

        buildingBarracksTimerInterval = setInterval(function () {
          seconds--;

          if (seconds >= 0) {
            minutes = Math.floor(seconds / 60);
            hours = Math.floor(minutes / 60);
          } else {
            minutes = 0;
            hours = 0;
          }

          let elem = document.querySelector(
            "#build-barracks-timer-" + buttonNumber
          );
          elem.value =
            "hours:" + hours + ", minute:" + minutes + ", seconds:" + seconds;
        }, millisecondTick);
      };

      const buildingFarmStartTimer = (
        millisecondTick,
        buildTime,
        buttonNumber
      ) => {
        console.log("buildingFarmStartTimer(..) called");
        let seconds = buildTime;
        let minutes = 0;
        let hours = 0;

        buildingFarmTimerInterval = setInterval(function () {
          seconds--;

          if (seconds >= 0) {
            minutes = Math.floor(seconds / 60);
            hours = Math.floor(minutes / 60);
          } else {
            minutes = 0;
            hours = 0;
          }

          let elem = document.querySelector(
            "#build-farm-timer-" + buttonNumber
          );
          elem.value =
            "hours:" + hours + ", minute:" + minutes + ", seconds:" + seconds;
        }, millisecondTick);
      };

      const buildingGoldMineStartTimer = (
        millisecondTick,
        buildTime,
        buttonNumber
      ) => {
        console.log("buildingGoldMineStartTimer(..) called");
        let seconds = buildTime;
        let minutes = 0;
        let hours = 0;

        buildingGoldMineTimerInterval = setInterval(function () {
          seconds--;

          if (seconds >= 0) {
            minutes = Math.floor(seconds / 60);
            hours = Math.floor(minutes / 60);
          } else {
            minutes = 0;
            hours = 0;
          }

          let elem = document.querySelector(
            "#build-gold-mine-timer-" + buttonNumber
          );
          elem.value =
            "hours:" + hours + ", minute:" + minutes + ", seconds:" + seconds;
        }, millisecondTick);
      };

      const buildingLumberMillStartTimer = (
        millisecondTick,
        buildTime,
        buttonNumber
      ) => {
        console.log("buildingLumberMillStartTimer(..) called");
        let seconds = buildTime;
        let minutes = 0;
        let hours = 0;

        buildingLumberMillTimerInterval = setInterval(function () {
          seconds--;

          if (seconds >= 0) {
            minutes = Math.floor(seconds / 60);
            hours = Math.floor(minutes / 60);
          } else {
            minutes = 0;
            hours = 0;
          }

          let elem = document.querySelector(
            "#build-lumber-mill-timer-" + buttonNumber
          );
          elem.value =
            "hours:" + hours + ", minute:" + minutes + ", seconds:" + seconds;
        }, millisecondTick);
      };

      const buildingIronMineStartTimer = (
        millisecondTick,
        buildTime,
        buttonNumber
      ) => {
        console.log("buildingIronMineStartTimer(..) called");
        let seconds = buildTime;
        let minutes = 0;
        let hours = 0;

        buildingIronMineTimerInterval = setInterval(function () {
          seconds--;

          if (seconds >= 0) {
            minutes = Math.floor(seconds / 60);
            hours = Math.floor(minutes / 60);
          } else {
            minutes = 0;
            hours = 0;
          }

          let elem = document.querySelector(
            "#build-iron-mine-timer-" + buttonNumber
          );
          elem.value =
            "hours:" + hours + ", minute:" + minutes + ", seconds:" + seconds;
        }, millisecondTick);
      };

      const buildingBarracksStopTimer = () => {
        console.log("buildingBarracksStopTimer() called");
        clearInterval(buildingBarracksTimerInterval);
      };

      const buildingFarmStopTimer = () => {
        console.log("buildingFarmStopTimer() called");
        clearInterval(buildingFarmTimerInterval);
      };

      const buildingGoldMineStopTimer = () => {
        console.log("buildingGoldMineStopTimer() called");
        clearInterval(buildingGoldMineTimerInterval);
      };

      const buildLumberMillStopTimer = () => {
        console.log("buildLumberMillStopTimer() called");
        clearInterval(buildingLumberMillTimerInterval);
      };

      const buildIronMineStopTimer = () => {
        console.log("buildIronMineStopTimer() called");
        clearInterval(buildingIronMineTimerInterval);
      };

      const buildSettlement = async () => {
        console.log("buildSettlement() called");

        settlementCreated = await createSettlement((settlement) => {
          console.log("settlement created");
          console.log(settlement);

          showBuildBuildingsControls();
          //showProductionControls();
          //disableProductionButtons();
          showInventoryControls();
        });
      };

      const buildBarracksHandler = async (buttonNumber) => {
        console.log("buildBarracksHandler() called");

        document.getElementById(
          "build-barracks-button-" + buttonNumber
        ).disabled = true;

        let elem = document.querySelector(
          "#build-barracks-status-" + buttonNumber
        );
        elem.value = "Building Barracks...";

        const newBarracks = await createBuilding(
          settlementCreated.id,
          "barracks"
        );

        buildingBarracksStartTimer(
          millisecondTickForTimer,
          barracksBuildTime,
          buttonNumber
        );
        monitorBuildingBarracksStatus(
          newBarracks.id,
          "barracks",
          barracksBuildTime,
          buttonNumber
        );
      };

      const buildFarmHandler = async (buttonNumber) => {
        if (isFarmReadyForCollection1 !== true) {
          console.log("buildFarmHandler() called for building");

          document.getElementById(
            "build-farm-button-" + buttonNumber
          ).disabled = true;

          let elem = document.querySelector(
            "#build-farm-status-" + buttonNumber
          );
          elem.value = "Building Farm...";

          const newFarm = await createBuilding(settlementCreated.id, "farm");

          buildingFarmStartTimer(
            millisecondTickForTimer,
            farmBuildTime,
            buttonNumber
          );
          monitorBuildingFarmStatus(
            newFarm.id,
            "farm",
            farmBuildTime,
            buttonNumber
          );
        } else {
          console.log("buildFarmHandler() called for collecting");
          console.log(
            "farmBuildingIdForCollection: " + farmBuildingIdForCollection1
          );
          collect(farmBuildingIdForCollection1, "food");
        }
      };

      const buildGoldMineHandler = async (buttonNumber) => {
        console.log("buildGoldMineHandler() called");

        document.getElementById(
          "build-gold-mine-button-" + buttonNumber
        ).disabled = true;

        let elem = document.querySelector(
          "#build-gold-mine-status-" + buttonNumber
        );
        elem.value = "Building Gold Mine...";

        const newGoldMine = await createBuilding(
          settlementCreated.id,
          "gold-mine"
        );

        buildingGoldMineStartTimer(
          millisecondTickForTimer,
          goldMineBuiltTime,
          buttonNumber
        );
        monitorBuildingGoldMineStatus(
          newGoldMine.id,
          "gold-mine",
          goldMineBuiltTime,
          buttonNumber
        );
      };

      const buildLumberMillHandler = async (buttonNumber) => {
        console.log("buildLumberMillHandler() called");

        document.getElementById(
          "build-lumber-mill-button-" + buttonNumber
        ).disabled = true;

        let elem = document.querySelector(
          "#build-lumber-mill-status-" + buttonNumber
        );
        elem.value = "Building Lumber Mine...";

        const newLumberMill = await createBuilding(
          settlementCreated.id,
          "lumber-mill"
        );

        buildingLumberMillStartTimer(
          millisecondTickForTimer,
          lumberMillBuildTime,
          buttonNumber
        );
        monitorBuildingLumberMillStatus(
          newLumberMill.id,
          "lumber-mill",
          lumberMillBuildTime,
          buttonNumber
        );
      };

      const buildIronMineHandler = async (buttonNumber) => {
        console.log("buildIronMineHandler() called");

        document.getElementById(
          "build-iron-mine-button-" + buttonNumber
        ).disabled = true;

        let elem = document.querySelector(
          "#build-iron-mine-status-" + buttonNumber
        );
        elem.value = "Building Iron Mine...";

        const newIronMine = await createBuilding(
          settlementCreated.id,
          "iron-mine"
        );

        buildingIronMineStartTimer(
          millisecondTickForTimer,
          ironMineBuildTime,
          buttonNumber
        );
        monitorBuildingIronMineStatus(
          newIronMine.id,
          "iron-mine",
          ironMineBuildTime,
          buttonNumber
        );
      };

      const buildBarracksActivatedCallback = async (
        activatedBarracks,
        buttonNumber
      ) => {
        console.log("buildBarracksActivatedCallback(.) called");
        buildingBarracksStopTimer();

        let elem = document.querySelector(
          "#build-barracks-status-" + buttonNumber
        );
        elem.value = "Barracks created";

        console.log("Barracks created");
        console.log(activatedBarracks);

        startProduction("barracks", "soldier", buttonNumber);
      };

      const buildFarmActivatedCallback = async (
        activatedFarm,
        buttonNumber
      ) => {
        console.log("buildFarmActivatedCallback(.) called");
        buildingFarmStopTimer();

        let elem = document.querySelector("#build-farm-status-" + buttonNumber);
        elem.value = "Farm created";

        console.log("Farm created");
        console.log(activatedFarm);

        startProduction("farm", "food", buttonNumber);
      };

      const buildGoldMineActivatedCallback = async (
        activatedGoldMine,
        buttonNumber
      ) => {
        console.log("buildGoldMineActivatedCallback(.) called");
        buildingGoldMineStopTimer();

        let elem = document.querySelector(
          "#build-gold-mine-status-" + buttonNumber
        );
        elem.value = "Gold Mine created";

        console.log("Gold Mine created");
        console.log(activatedGoldMine);

        startProduction("gold-mine", "gold", buttonNumber);
      };

      const buildLumberMillActivatedCallback = async (
        activatedLumberMill,
        buttonNumber
      ) => {
        console.log("buildLumberMillActivatedCallback(.) called");
        buildLumberMillStopTimer();

        let elem = document.querySelector(
          "#build-lumber-mill-status-" + buttonNumber
        );
        elem.value = "Lumber Mill created";

        console.log("Lumber Mill created");
        console.log(activatedLumberMill);

        startProduction("lumber-mill", "lumber", buttonNumber);
      };

      const buildIronMineActivatedCallback = async (
        activatedIronMine,
        buttonNumber
      ) => {
        console.log("buildIronMineActivatedCallback() called");
        buildIronMineStopTimer();

        let elem = document.querySelector(
          "#build-iron-mine-status-" + buttonNumber
        );
        elem.value = "Iron Mine created";

        console.log("Iron mine created");
        console.log(activatedIronMine);

        startProduction("iron-mine", "iron", buttonNumber);
      };
    </script>

    <table class=".simulator-ui-container">
      <tr>
        <th id="user-info"></th>
      </tr>
      <tr>
        <td>
          <button
            id="register-button"
            type="button"
            onclick="javascript:registerHandler()"
          >
            Register
          </button>
        </td>
      </tr>
      <tr>
        <td>
          <button
            id="login-button"
            type="button"
            onclick="javascript:loginHandler()"
          >
            Login
          </button>
        </td>
      </tr>
      <tr id="build-barracks-row-1">
        <td>
          <p>Building Controls</p>
          <button
            id="build-barracks-button-1"
            type="button"
            onclick="javascript:buildBarracksHandler(1)"
          >
            Build Barracks
          </button>
          <label>Timer </label
          ><input
            id="build-barracks-timer-1"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-barracks-status-1" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-farm-row-1">
        <td>
          <button
            id="build-farm-button-1"
            type="button"
            onclick="javascript:buildFarmHandler(1)"
          >
            Build Farm
          </button>
          <label>Timer </label
          ><input
            id="build-farm-timer-1"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-farm-status-1" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-farm-row-2">
        <td>
          <button
            id="build-farm-button-2"
            type="button"
            onclick="javascript:buildFarmHandler(2)"
          >
            Build Farm
          </button>
          <label>Timer </label
          ><input
            id="build-farm-timer-2"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-farm-status-2" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-farm-row-3">
        <td>
          <button
            id="build-farm-button-3"
            type="button"
            onclick="javascript:buildFarmHandler(3)"
          >
            Build Farm
          </button>
          <label>Timer </label
          ><input
            id="build-farm-timer-3"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-farm-status-3" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-gold-mine-row-1">
        <td>
          <button
            id="build-gold-mine-button-1"
            type="button"
            onclick="javascript:buildGoldMineHandler(1)"
          >
            Build Gold Mine
          </button>
          <label>Timer </label
          ><input
            id="build-gold-mine-timer-1"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-gold-mine-status-1" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-gold-mine-row-2">
        <td>
          <button
            id="build-gold-mine-button-2"
            type="button"
            onclick="javascript:buildGoldMineHandler(2)"
          >
            Build Gold Mine
          </button>
          <label>Timer </label
          ><input
            id="build-gold-mine-timer-2"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-gold-mine-status-2" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-gold-mine-row-3">
        <td>
          <button
            id="build-gold-mine-button-3"
            type="button"
            onclick="javascript:buildGoldMineHandler(3)"
          >
            Build Gold Mine
          </button>
          <label>Timer </label
          ><input
            id="build-gold-mine-timer-3"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-gold-mine-status-3" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-lumber-mill-row-1">
        <td>
          <button
            id="build-lumber-mill-button-1"
            type="button"
            onclick="javascript:buildLumberMillHandler(1)"
          >
            Build Lumber Mill
          </button>
          <label>Timer </label
          ><input
            id="build-lumber-mill-timer-1"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-lumber-mill-status-1" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-lumber-mill-row-2">
        <td>
          <button
            id="build-lumber-mill-button-2"
            type="button"
            onclick="javascript:buildLumberMillHandler(2)"
          >
            Build Lumber Mill
          </button>
          <label>Timer </label
          ><input
            id="build-lumber-mill-timer-2"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-lumber-mill-status-2" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-lumber-mill-row-3">
        <td>
          <button
            id="build-lumber-mill-button-3"
            type="button"
            onclick="javascript:buildLumberMillHandler(3)"
          >
            Build Lumber Mill
          </button>
          <label>Timer </label
          ><input
            id="build-lumber-mill-timer-3"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-lumber-mill-status-3" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-iron-mine-row-1">
        <td>
          <button
            id="build-iron-mine-button-1"
            type="button"
            onclick="javascript:buildIronMineHandler(1)"
          >
            Build Iron Mine
          </button>
          <label>Timer </label
          ><input
            id="build-iron-mine-timer-1"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-iron-mine-status-1" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-iron-mine-row-2">
        <td>
          <button
            id="build-iron-mine-button-2"
            type="button"
            onclick="javascript:buildIronMineHandler(2)"
          >
            Build Iron Mine
          </button>
          <label>Timer </label
          ><input
            id="build-iron-mine-timer-2"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-iron-mine-status-2" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="build-iron-mine-row-3">
        <td>
          <button
            id="build-iron-mine-button-3"
            type="button"
            onclick="javascript:buildIronMineHandler(3)"
          >
            Build Iron Mine
          </button>
          <label>Timer </label
          ><input
            id="build-iron-mine-timer-3"
            type="text"
            disabled="true"
            size="31"
          />
          <label>Status </label
          ><input id="build-iron-mine-status-3" type="text" disabled="true" />
        </td>
      </tr>
      <tr id="production-buttons-row">
        <td>
          <p>Collection</p>
          <button
            id="produce-barracks-button"
            type="button"
            onclick="javascript:collect(barracksBuildingIdForCollection, 'soldiers') "
          >
            Collect Soldier
          </button>
          <button
            id="produce-farm-button"
            type="button"
            onclick="javascript:collect(farmBuildingIdForCollection, 'food') "
          >
            Collect Food
          </button>
          <button
            id="produce-gold-mine-button"
            type="button"
            onclick="javascript:collect(goldMineBuildingIdForCollection, 'gold') "
          >
            Collect Gold
          </button>
          <button
            id="produce-lumber-mill-button"
            type="button"
            onclick="javascript:collect(lumberMillBuildingIdForCollection, 'lumber') "
          >
            Collect Lumber
          </button>
          <button
            id="produce-iron-mine-button"
            type="button"
            onclick="javascript:collect(ironMineBuildingIdForCollection, 'iron') "
          >
            Collect Iron
          </button>
        </td>
      </tr>
    </table>
    <br />
    <br />
    <table>
      <tr>
        <th id="inventory-info">Inventory</th>
      </tr>
      <tr>
        <td id="inventory-soldiers">soldier: 0</td>
      </tr>
      <tr>
        <td id="inventory-food">food: 0</td>
      </tr>
      <tr>
        <td id="inventory-gold">gold: 0</td>
      </tr>
      <tr>
        <td id="inventory-lumber">lumber: 0</td>
      </tr>
      <tr>
        <td id="inventory-iron">iron: 0</td>
      </tr>
    </table>
  </body>
</html>
